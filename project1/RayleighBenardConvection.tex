\documentclass[11pt]{article} % use larger type; default would be 10pt

% Common packages for mathematical articles
\usepackage{fullpage,amsmath,amsfonts,mathpazo,microtype,nicefrac,algorithm2e,graphicx}

% MSE Packages
\usepackage{caption}
\usepackage{physics}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{parskip}

% MSE Make margins a bit smaller
\usepackage[margin=0.75in]{geometry}

% Set-up for hypertext references
\usepackage{hyperref,color,textcomp}
\definecolor{webgreen}{rgb}{0,.35,0}
\definecolor{webbrown}{rgb}{.6,0,0}
\definecolor{RoyalBlue}{rgb}{0,0,0.9}
\hypersetup{
   colorlinks=true, linktocpage=true, pdfstartpage=3, pdfstartview=FitV,
   breaklinks=true, pdfpagemode=UseNone, pageanchor=true, pdfpagemode=UseOutlines,
   plainpages=false, bookmarksnumbered, bookmarksopen=true, bookmarksopenlevel=1,
   hypertexnames=true, pdfhighlight=/O,
   urlcolor=webbrown, linkcolor=RoyalBlue, citecolor=webgreen,
   pdfsubject={Harvard IACS AC 290 R},
   pdfkeywords={},
   pdfcreator={pdfLaTeX},
   pdfproducer={LaTeX with hyperref}
}
\hypersetup{pdftitle={AC290-RBC}}


% MSE Macros
\newcommand{\tty}[1]{\texttt{#1}}
\newcommand{\uu}{\vectorbold{u}}
\newcommand{\vv}{\vectorbold{u}}
\newcommand{\Laplace}{\Delta}

%***Start of Document***
\title{Numerical Simulation of Rayleigh-B\'enard Convection}
\author{Harvard IACS AC 290R - Group 1 \\
Michael S. Emanuel \\
Jonathan Guillotte-Blouin \\
Yue Sun \\
}
\date{14-March-2019} 

\begin{document}
\maketitle

\section{Problem Statement and Motivation}
AC 290R is a course on extreme computing with a focus on the application domain of fluid dynamics.
Fluid dynamics is one of the most mature areas of high performance computation.
Long before there were social networks, scientists and engineers have used 
the most powerful computers available to understand weather systems and aerodynamics.
For our project in this module, we carried out a large scale numerical simulation of 
Rayleigh-B\'enard Convection using the Drekar code running on Harvard's Odyssey supercomputing cluster.  
\href{https://en.wikipedia.org/wiki/Rayleigh%E2\%80%93B%C3%A9nard_convection}
{Rayleigh-B\'enard Convection} (RBC) is a classical problem in fluid dynamics.
It is the phyical phenomenon that arises any time a fluid in a gravitational field has a temperature gradient.
As anyone who lives in an old building can attest, hot air rises and cold air falls.  
This buoyancy effect of warm fluids expanding and becoming less dense is quite general.
When the temperature driven thermal forces are large enough compared to viscous forces,
the fluid will move with characteristic circular flows bringing hot fluid higher and cold fluid lower.
If the the thermal forces become large enough, a turbulent flow will emerge.

A number of scientifically important physical phenomena involve RBC.
Some of the more prominent ones include:
\begin{itemize}
\item\href{https://en.wikipedia.org/wiki/Stellar_evolution}{Stellar evolution}:
The gas at the center of a star is hotter than the gas at the outside, and a spherical RBC flow develops
\item\href{https://en.wikipedia.org/wiki/Plate_tectonics}{Plate tectonics}:
The center of the earth hot, with a layer of magma on top and a cool crust.  
Over geologic time scales, the earth's mantle behaves like a fluid, and plate tectonics is an instance of RBC.
\item{Weather systems}: Warm air rises in the earth's atmosphere and RBC drives weather processes. 
A concrete example is a \href{https://en.wikipedia.org/wiki/Mesoscale_convective_system}{mesoscale convective system}.
\end{itemize}

Our goals in this project are two-fold.  
We would like to learn some basic precepts of fluid dynamics and gain a working knowledge of RBC.
We acknowledge however that fluid dynamics is far too large and complicated a field for us 
to gain a deep understanding in such a short time.
Our primary goal, as suggested by the course title \textbf{Extreme Computing}
is to learn state of the art techniques in scientific computing at a large scale.
We choose to work on a real problem, RBC, rather than a toy problem because
it is both more interesting and we will learn more.

The particular problem we simulated numerically is a two dimensional turbulent Rayleigh-B\'enard Convection.  
This is described mathematically with a set of three equations called the Boussinesq equations.
The \href{https://en.wikipedia.org/wiki/Boussinesq_approximation_(buoyancy)}{Boussinesq approximation} 
is based on a linearization of the buoyancy effect.
The buoyancy effect is approximated as 
$$ \rho(T_0 + \delta T) \approx \rho(T_0) - \frac{\partial \rho}{\partial T}\Bigr|_{T=T_0}$$
We define the coefficient of volume expansion as
\footnote{See here a discussion of  \href{https://en.wikipedia.org/wiki/Thermal_expansion}{thermal expansion} generally}
$$\alpha_V = -\frac{1}{\rho_0}\frac{\partial \rho}{\partial T}\Bigr|_{T=T_0}$$
The coefficient of volume expansion is a property of a fluid.
The second simplifying assumption made in the Boussinesq equations is that fluids are incompressible
(except for this linear sensitivity of their density to temperature).
The Navier-Stokes equations then simplify to the three Boussinesq equations:
\begin{align}
\frac{\partial \uu}{\partial t} + \grad \cdot (\uu \otimes \uu) &= \frac{1}{\rho_0} \grad P + \nu \grad^2 \uu + \alpha_V g T \hat{y} \\
\grad \cdot \uu &= 0 \\
\frac{\partial T}{\partial t} + \grad \cdot (uT) &= \kappa \grad^2 T
\end{align}

In these equations, $\rho_0$ is is the density at the reference temperature $T_0$.
$\nu$ is the fluid viscosity and $\kappa$ is the thermal diffusivity.

The presentation above includes the physical constants and is suitable for engineering.
For mathematics, it is often preferable to use nondimensional equations.
\footnote{See this article on the technique of \href{https://en.wikipedia.org/wiki/Nondimensionalization}{nomdimensionalization}.}
There are three choices that have been used for nondimensionalizing the Boussinesq equations.
We follow the classical approach and choose the following dimensionless parameters:
\begin{itemize}
\item{$\Delta T = T_{bot} - T_{top}$} the temperature difference; this is the temperature scale
\item{$H=y_{top} - y_{bot}$} the height of the channel; this is the length scale
\item{$\tau = \nicefrac{H^2}{\kappa}$} is the time scale; this choice is called ``thermal scaling''
\item{$U = \nicefrac{H}{\tau}$} is the velocity scale
\item{$\rho_0 U^2$} is the pressure scale
\end{itemize}

With this choice of dimensionless parameters, we have the non-dimensional Boussinesq equations:
\begin{align}
\frac{\partial \uu}{\partial t} + \grad \cdot (\uu \otimes \uu) &= \grad P + \textrm{Pr} \grad^2 \uu + \textrm{RaPr}T \hat{y} \\
\grad \cdot \uu &= 0 \\
\frac{\partial T}{\partial t} + \grad \cdot (uT) &=  \grad^2 T
\end{align}

There are two dimensionless ratios appearing:
\begin{itemize}
\item{Pr} is the \href{https://en.wikipedia.org/wiki/Prandtl_number}{Prandtl number}, $\textrm{Pr} = \nicefrac{\nu}{\kappa}$.  
This is the ratio of the thermal viscosity to the thermal diffusivity and is a property of the fluid.
\item{Ra} is the famous \href{https://en.wikipedia.org/wiki/Rayleigh_number}{Rayleigh number}.  It is defined by
$$\textrm{Ra} = \frac{\alpha_V \Laplace T g H^3}{\nu \kappa}$$
The Rayleigh number describes the ratio of temperature driven forces to viscous forces.
For this reason, a very low Rayleigh number leads to no convective flow; 
an intermediate Rayleigh number leads to a somewhat regular flow;
and a high Rayleigh number leads to a turbulent flow.
\end{itemize}

\section{Description of Code}
Drekar is a large scale computational fluid dynamics (CFD) code.
The name Drekar comes from the norse word describing a 
\href{https://en.wikipedia.org/wiki/Longship}{Viking Longship}.
It is under active development at \href{https://www.sandia.gov/}{Sandia National Laboratories}
and was recently made partially open source; details can be found at the US Department of Energy
Office of Scientific and Technical Information at \href{https://www.osti.gov/biblio/1364765}{OSTI.gov}.
Because some parts of this code are sensitive, e.g. they could be used for simulations of nuclear weapons,
these parts are not being released to the public.
Sensitive components will remain restricted to employees and affiliates of Sandia.


Drekar solves the partial differential equations (PDEs) of fluids using the Finite Element Method.
In addition to simulating traditional fluid dynamics problems, Drekar also has the capability to handle
electromagnetic forces.  This is important when modeling plasma physics and stars for example.
Drekar is able to accurately simulate different kinds of physical systems including incompressible fluids,
low-mach compressible fluids, and compressible / incompressible magnetohydrodynamics.
It can also handle multi-species plasmas interacting with a magnetic field;
this is used to simulate \href{https://en.wikipedia.org/wiki/Tokamak}{Tokamak} reactors.
Researchers at Sandia are collaborating with the team building the \href{https://en.wikipedia.org/wiki/ITER}{ITER}
in Southern france, which will be the world's largest megnetic confinement plasma physics experiment when
it is constructed.

The heart of Drekar is a massively parallel implementation of the 
\href{https://en.wikipedia.org/wiki/Finite_element_method}{Finite Element Method}.
The Finite Element Method is a numerical method for solving partial differential equations.
We will discuss it further in the next section.
Drekar is a modern software project written in C++ and making extensive use of classes and templates.  
This allows it to be flexible and to run efficiently on heterogeneous hardware.

Drekar implements parallelization at multiple levels.
At the top level, it uses 
\href{https://en.wikipedia.org/wiki/Message_Passing_Interface}{Message Passing Interface} (MPI)
to distribute computations across multiple computing nodes that are connected on
the same high performance network.
Back end modules of Drekar also permit parallelization at the level of C++ threads;
\href{https://en.wikipedia.org/wiki/OpenMP}{OpenMP} (multiple cores on one host); 
and GPUs with \href{https://en.wikipedia.org/wiki/CUDA}{CUDA}.

Drekar has basic components that handle primitive linear algebra tasks such as 
distributing a matrix or a vector across multiple compute nodes.
Building up in complexity, it knows how to add vectors,
perform vector dot products and matrix / vector products.
It can solve linear equations exactly or approximately using Krylov methods,
and similarly for eigenvalue problems.
And it can solve nonlinear equations using iterative methods
(typically refinements of Newton's method).

These building blocks enable Drekar to simulate a wide variety of PDEs
using the finite element method, and to perform these scales efficiently at scale.
Drekar handles continuous, discontinuous and stabilized finite elements.
The flexibility and wide range of the C++ classes in Drekar allow it to simulate
mixed-integration finite element bases include nodal, edge, face and volume elements.
This allows a wide range of problems to be described.
The breadth of elements are particularly useful when enforcing complex boundary conditions.
Drekar also has the flexibility of simulating multiple physics regimes, called blocks, in one system.

Drekar includes algorithms for time integrating differential equations that are 
fully explicit, fully implicit, and mixed implicit / explicit (IMEX).  
Some degree of implicit solution is often required for real world problems
when there is a wide range of time scales.  If the fastest time scale
is too many orders of magnitude shorter than the longest one,
an explicit solver will either take time steps too large to capture the physics,
or take too long to run.  
Implicit and IMEX solvers permit the simulation to implicitly solve for physical
effects that are on too short a time scale to solve explicitly.

Drekar has strong tools for automatic differentiation.
These are necessary because many methods used in Drekar require
taking derivatives of functions, e.g. solving nonlinear equations with a variant of Newton's method.  
Some other software libraries required users to supply hand coded derivatives, 
which can be time consuming and error prone;
or to use numerical derivatives, which can be slow.
Automatic differentiation allows the best of both worlds.

Drekar is built as a part of a collection of packages called
\href{https://trilinos.github.io/}{Trilinos}.
Trilinos arose out of an effort at Sandia to avoid duplication of effort across
different research groups and allow each group to focus on the frontier
of discovery in their area without reinventing the wheel.
Some packages in Trilinos relevant to Drekar include:
\begin{itemize}
\item{Linear solvers}: \textit{Amesos} (direct) and \textit{Aztec00}, \textit{Belos} (indirect)
\item{Preconditioners}: \textit{lfpack} (algebraic), \textit{ML} (multilevel), \textit{Meros} (block)
\item{Eigenvalue solvers}: \textit{Anasazi}
\item{Nonlinear solvers}: \textit{NOX}
\item{Time Integrators}: \textit{Rhythmos, Tempus}
\item{Automatic Differentiation}: \textit{Sacado}
\end{itemize}
Consider for a moment how many of the basic building blocks used by Drekar
are provided by the packages listed above.
By building on this existing work, the developers of Drekar were able 
to concentrate their efforts on the distinctive aspects of the problem,
namely solving PDEs with the Finite Element Method.
Having seen a number of software packages over the year, 
our first impression of Drekar is that it is a very sophisticated 
and impressive piece of software engineering.

\section{Overview of Numerical Methods Used}

\section{Parameters of the Simulation}
All parameters to the simulation are input with a configuration file.
This can be passed in either XML format (the old technique) or YML (the new technique).
We were provided with a template XML file which we then modified to incorporate the 
specific parameter settings 

We generated a mesh using a program called Pamgen.  Here are the key parameters for the mesh (spatial layout):
\begin{itemize}
\item{length} $L=2$  with $N_x = 2048 + 1$ uniformly spaced mesh points
\item{height} $H=1$ with $N_y = 1024 + 1$ Chebyshev spaced mesh points
\item{$\Gamma = \nicefrac{L}{H} = 2$}
\item{x} ranges from -1 to +1
\item{y} ranges from -1 to +1
\end{itemize}

Here are descriptions of the key physical parameters for the simulation
\\ \textbf{NEED TO CHECK THESE AGAINST FILE RUN ON ODYSSEY!}
\begin{itemize}
\item{density} $\rho_0 = 1.0$
\item{viscosity} $\nu = 0.01$
\item{volume expansion coefficient} $\alpha_V = 10^6$
\item{gravity} $g = 1.0$
\item{heat capacity} 1.0
\item{thermal conductivity} $\kappa = 0.01$
\item{temperature change} $\Delta T = 1.0$ 
\item{height} $H = 1.0$
\end{itemize}

Using these parameters, we can compute the implied dimensionless constants:
\begin{align}
\textrm{Pr} &= \frac{\nu}{\kappa} = \frac{0.01}{0.01} = 1.0 \\
\textrm{Ra} &= \frac{\alpha_V \Delta T g H^3}{\nu \kappa} = \frac{10^{6} \cdot 1.0 \cdot 1^3}{0.01 \cdot 0.01} = \frac{10^{6}}{10^{-4}} = 10^{10}
\end{align}
We comment in passing that in order to achieve the required Rayleigh constant of $10^{10}$, 
we solved for the required volume expansion coefficient $\alpha_V$ given the other parameter settings.

In addition to the phyiscal constants, some additional parameters were passed to Drekar 
specifying the boundary conditions and how the physics should be modeled.
Important settings of this type included:
\begin{itemize}
\item{Initial conditions} $U_x = 0$, $U_y = 0$, $P = 0$.  The velocity and pressure started uniformly zero.
The temperature starts with a trigonometric function from 0 to 1.
\item{No slip boundary condition} $U_x = 0$, $U_y = 0$ 
on the top (surface\_4) and bottom (surface\_2).
\item{Applied temperature gradient} $T=0$ at the top, $T=1$ at the bottom; therefore $\Delta T = 1$
\item{Finite element basis for PDEs} The continuity, momentum and energy equations all share the same
finite element settings.  The basis is HGrad of order 1 with integration order 2.  Stabilization is on.
\item{Stress tensor} is modeled as Newtonian.
\item{Source momentum} is modeled with the Boussinesq approximation; 
using a reference density of 1.0 and a reference temperature of 0.5, the mean for the simulation.
\end{itemize}

\section{Results}

\section{Conclusions and Future Work}


\end{document}
